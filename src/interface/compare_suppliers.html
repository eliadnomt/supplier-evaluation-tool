<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Compare Supplier Scores</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    nav a { margin-right: 12px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f5f5f5; }
    .button { display: inline-block; padding: 8px 12px; background: #08c; color: #fff; text-decoration: none; border-radius: 4px; }
    .error { color: #a00; }
  </style>
</head>
<body>
  <nav>
    <a href="/">Dashboard</a>
    <a href="/add">Add Supplier</a>
    <a href="/compare">Compare Scores</a>
  </nav>
  <h2>Compare Supplier Scores</h2>
  <p><button id="refreshBtn" class="button" style="background:#0b5">Refresh</button></p>
  <div id="status"></div>
  <table>
    <thead>
      <tr>
        <th>Supplier</th>
        <th>Ecobalyse Score</th>
        <th>Final CSR Score</th>
        <th>Error</th>
      </tr>
    </thead>
    <tbody id="scoresBody"></tbody>
  </table>
<script>
function loadScores() {
  document.getElementById('status').innerText = 'Loading scores...';
  fetch('/api/scores').then(r=>r.json()).then(rows => {
    const body = document.getElementById('scoresBody');
    body.innerHTML = '';
    for (const r of rows) {
      const tr = document.createElement('tr');
      const tdS = document.createElement('td'); tdS.innerText = r.supplier || '';
      const tdE = document.createElement('td'); tdE.innerText = (r.ecobalyse_score!==undefined && r.ecobalyse_score!==null) ? r.ecobalyse_score : '';
      const tdF = document.createElement('td'); tdF.innerText = (r.final_csr_score!==undefined && r.final_csr_score!==null) ? r.final_csr_score : '';
      const tdErr = document.createElement('td'); tdErr.innerText = r.error || '';
      if (r.error) tdErr.className = 'error';
      tr.appendChild(tdS); tr.appendChild(tdE); tr.appendChild(tdF); tr.appendChild(tdErr);
      body.appendChild(tr);
    }
    document.getElementById('status').innerText = '';
  }).catch(err => {
    document.getElementById('status').innerText = 'Error: ' + err;
  });
}
window.onload = loadScores;
document.getElementById('refreshBtn').onclick = loadScores;
</script>
</body>
</html>
